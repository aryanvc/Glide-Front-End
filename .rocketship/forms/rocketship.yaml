name: "Catalyst UI Kit - Form Interaction Tests"

vars:
  frontend_url: "{{ .env.FRONTEND_URL }}"

tests:
  - name: "Form: Project Creation - Live Preview Updates"
    steps:
      - name: "Test that form inputs update preview in real-time"
        plugin: playwright
        config:
          role: script
          headless: false
          script: |
            from playwright.sync_api import expect

            page.goto("{{ .env.FRONTEND_URL }}/projects/new", wait_until="networkidle")
            page.wait_for_load_state("networkidle")
            title_input = page.get_by_role("textbox", name="e.g., Monthly Bookkeeping & Financial Reporting")
            test_title = "Live Preview Test Project"
            title_input.fill(test_title)
            expect(page.get_by_role("heading", name=test_title, level=2)).to_be_visible()
            company_text = "This is a test company for E2E testing purposes."
            page.get_by_role("textbox", name="Tell us about your company...").fill(company_text)
            expect(page.get_by_text("This is a test company for E2E testing purposes.")).to_be_visible()
            scope_text = "We need help with automated testing and QA processes."
            page.get_by_role("textbox", name="Describe what you need help with...").fill(scope_text)
            expect(page.get_by_text("We need help with automated testing and QA processes.")).to_be_visible()
            page.get_by_role("button", name="5 – 7+ Years").click()
            expect(page.get_by_text("5 – 7+ Years")).to_be_visible()

  - name: "Form: Button Group Selections"
    steps:
      - name: "Test radio-style button group selections"
        plugin: playwright
        config:
          role: script
          headless: false
          script: |
            from playwright.sync_api import expect

            page.goto("{{ .env.FRONTEND_URL }}/projects/new", wait_until="networkidle")
            page.wait_for_load_state("networkidle")
            btn_1_3 = page.get_by_role("button", name="1 – 3 Years").first
            btn_1_3.click()
            assert btn_1_3.get_attribute("aria-pressed") in ["true", "True"]
            btn_9_plus = page.get_by_role("button", name="9+ Years").first
            btn_9_plus.click()
            assert btn_9_plus.get_attribute("aria-pressed") in ["true", "True"]
            assert btn_1_3.get_attribute("aria-pressed") in ["false", "False", None]
            btn_asap动员 = page.get_by_role("button", name="ASAP").first
            btn_asap.click()
            assert btn_asap.get_attribute("aria-pressed") in ["true", "True"]
            btn_future = page.get_by_role("button", name="Planning for the Future").first
            btn_future.click()
            assert btn_future.get_attribute("aria-pressed") in ["true", "True"]
            assert btn_asap.get_attribute("aria-pressed") in ["false", "False", None]
            btn_ft = page.get_by_role("button", name="Full-Time Equivalent").first
            btn_ft.click()
            assert btn_ft.get_attribute("aria-pressed") in ["true", "True"]
            btn_recurring = page.get_by_role("button", name="Recurring / Monthly").first
            btn_recurring.click()
            assert btn_recurring.get_attribute("aria-pressed") in ["true", "True"]

  - name: "Form: Required Field Validation"
    steps:
      - name: "Test form validation for required fields"
        plugin: playwright
        config:
          role: script
          headless: false
          script: |
            from playwright.sync_api import expect

            page.goto("{{ .env.FRONTEND_URL }}/projects/new", wait_until="networkidle")
            page.wait_for_load_state("networkidle")
            expect(page.get_by_text("Project Title *")).to_be_visible()
            expect(page.get_by_text("Company Overview *")).to_be_visible()
            expect(page.get_by_text("Scope of Work *")).to_be_visible()
            expect(page.get_by_role("textbox", name="e.g., Monthly Bookkeeping & Financial Reporting")).to_be_visible()
            expect(page.get_by_role("textbox", name="Tell us about your company...")).to_be_visible()
            expect(page.get_by_role("textbox", name="Describe what you need help with...")).to_be_visible()

  - name: "Form: Slider Interaction"
    steps:
      - name: "Test estimated hires slider"
        plugin: playwright
        config:
          role: script
          headless: false
          script: |
            from playwright.sync_api import expect

            page.goto("{{ .env.FRONTEND_URL }}/projects/new", wait_until="networkidle")
            page.wait_for_load_state("networkidle")
            slider = page.locator('input[type="range"]').first
            expect(slider).to_be_visible()
            initial_value = slider.get_attribute("value")
            assert initial_value == "1", f"Expected slider value to be '1', but got '{initial_value}'"
            expect(page.get_by_text("Estimated Hires: 1")).to_be_visible()
